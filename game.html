<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNES Matching Game</title>
    <style>
        /* https://www.color-hex.com/color-palette/22515 */
        body {
            height: 100vh;
            margin: 0;
            font-family: Arial, Helvetica, sans-serif;
            color: #211a21;
            background: #cec9cc;

            display: flex;
            flex-direction: column; /*stacks child elements vertically*/
            justify-content: center; /*aligns items across the main axis [vertical here]*/
            align-items: center; /*aligns items across the cross axis [horizontal here]*/
        }
        img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .row {
            width: 600px;
            height: 80px;
            padding: 5px;
            border: 5px solid #4f43ae;
            background: #908a99;

            display: flex;
            justify-content: space-evenly; /*aligns items across the main axis [horizontal here]*/
            align-items: center; /*aligns items across the cross axis [vertical here]*/
        }
        .item {
            /* Box art image ratios: 90:62 (most), 90:65 (Chrono Trigger, DKC2, Earthbound) */
            width: 90px;
            height: 62px;
            border: 5px solid #211a21;
            background: #b5b6e4;
        }
        .spacer {
            height: 5px;
        }
        #fill {
            width: 90px;
            height: 62px;
            color: white;
            background: #4f43ae;
            
            display: flex;
            justify-content: center; /*aligns items across the main axis [horizontal here]*/
            align-items: center; /*aligns items across the cross axis [vertical here]*/
        }
        /* Settings modal styles (polished) */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(11,10,12,0.55);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }
        .modal {
            background: linear-gradient(180deg,#fff 0%, #fbfbff 100%);
            color: #1f1724;
            padding: 18px;
            border-radius: 12px;
            width: 360px;
            max-width: calc(100% - 40px);
            box-shadow: 0 10px 30px rgba(16,12,32,0.45);
            border: 1px solid rgba(79,67,174,0.12);
            font-size: 14px;
        }
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .modal h2 {
            margin: 0;
            font-size: 18px;
            letter-spacing: 0.2px;
        }
        .modal p.subtitle {
            margin: 6px 0 12px 0;
            color: #4b415b;
            font-size: 13px;
        }
        .modal .row {
            /* reset global `.row` properties so modal rows don't inherit the large game row box */
            width: auto;
            height: auto;
            padding: 0;
            border: none;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin: 0 0 12px 0;
        }
        /* Custom switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 28px;
        }
        .switch input { display: none; }
        .switch .slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: #d8d6e9;
            border-radius: 999px;
            transition: background 160ms ease;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.3);
        }
        .switch .slider::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 4px;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #fff;
            box-shadow: 0 2px 6px rgba(31,23,36,0.15);
            transition: left 160ms ease, transform 160ms ease;
        }
        .switch input:checked + .slider {
            background: linear-gradient(90deg,#6e5ce6,#4f43ae);
        }
        .switch input:checked + .slider::after {
            left: 24px;
            transform: translateY(-50%);
        }
        .modal .actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 6px;
        }
        .btn {
            border: none;
            padding: 9px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: transform 80ms ease, box-shadow 80ms ease;
        }
        .btn:active { transform: translateY(1px); }
        .btn-primary {
            background: linear-gradient(180deg,#6e5ce6,#4f43ae);
            color: #fff;
            box-shadow: 0 6px 18px rgba(79,67,174,0.18);
        }
        .btn-ghost {
            background: transparent;
            color: #4b415b;
            border: 1px solid rgba(75,65,91,0.08);
        }
        /* Accessibility focus */
        .btn:focus, .switch input:focus + .slider { outline: 3px solid rgba(79,67,174,0.18); outline-offset: 3px; }
    </style>
</head>
<body>
    <!-- Settings modal (shown on first load or until user confirms) -->
    <div id="settingsModal" class="modal-overlay" style="display:none;">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
            <div class="modal-header">
                <h2 id="settingsTitle">Game Settings</h2>
            </div>
            <p class="subtitle">Choose your preferences before starting. You can change these later.</p>
            <div class="row">
                <div>
                    <div style="font-weight:600;">Sound</div>
                    <div style="font-size:12px;color:#6a5f73;">Enable game audio effects</div>
                </div>
                <label class="switch" title="Toggle sound">
                    <input id="soundToggle" type="checkbox">
                    <span class="slider" aria-hidden="true"></span>
                </label>
            </div>
            <div class="actions">
                <button id="cancelBtn" class="btn btn-ghost" type="button">Cancel</button>
                <button id="startBtn" class="btn btn-primary" type="button">Save & Start</button>
            </div>
        </div>
    </div>
    <main>
        <div class="row">
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
        </div>
        <div class="spacer"></div>
        <div class="row">
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
        </div>
        <div class="spacer"></div>
        <div class="row">
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item">
                <div id="fill" onclick="reloadPage()"></div>
            </div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
        </div>
            <div class="spacer"></div>
        <div class="row">
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
        </div>
            <div class="spacer"></div>
        <div class="row">
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
            <div class="item getsImg" onclick="handleComparison(this)"></div>
        </div>
    </main>
    <!-- In-game floating sound toggle -->
    <button id="inGameToggle" aria-pressed="true" title="Toggle sound" class="in-game-toggle">ðŸ”Š</button>
    <script>

        // Interaction gate while settings modal is open
        let allowInteraction = false;

        // Sound setting (persisted in localStorage)
        let isSoundEnabled = true;

        function playSound(audioObj) {
            if (!isSoundEnabled) return;
            try {
                audioObj.currentTime = 0;
                audioObj.play();
            } catch (e) {
                // ignore play errors
            }
        }

        function setSoundEnabled(enabled) {
            isSoundEnabled = !!enabled;
            try { localStorage.setItem('snes_sound', isSoundEnabled ? '1' : '0'); } catch(e){}
        }

        function loadSettingsToUI() {
            try {
                const val = localStorage.getItem('snes_sound');
                if (val === null) {
                    isSoundEnabled = true;
                } else {
                    isSoundEnabled = val === '1';
                }
            } catch (e) {
                isSoundEnabled = true;
            }
            const toggle = document.getElementById('soundToggle');
            if (toggle) toggle.checked = isSoundEnabled;
        }

        function showSettingsModal() {
            loadSettingsToUI();
            document.getElementById('settingsModal').style.display = 'flex';
            allowInteraction = false;
            // focus primary action for quick keyboard start
            const startBtn = document.getElementById('startBtn');
            if (startBtn) {
                // small timeout to ensure element is visible before focusing
                setTimeout(() => startBtn.focus(), 50);
            }
            // disable in-game toggle while modal visible
            const inGameToggle = document.getElementById('inGameToggle');
            if (inGameToggle) inGameToggle.disabled = true;
        }

        function hideSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
            allowInteraction = true;
            // re-enable in-game toggle after modal closed
            const inGameToggle = document.getElementById('inGameToggle');
            if (inGameToggle) inGameToggle.disabled = false;
        }

        // Wire modal button
        document.addEventListener('DOMContentLoaded', () => {
            const startBtn = document.getElementById('startBtn');
            const soundToggle = document.getElementById('soundToggle');
            const cancelBtn = document.getElementById('cancelBtn');
            const inGameToggle = document.getElementById('inGameToggle');
            if (startBtn && soundToggle) {
                startBtn.addEventListener('click', () => {
                    setSoundEnabled(soundToggle.checked);
                    hideSettingsModal();
                });
            }
            if (cancelBtn) {
                cancelBtn.addEventListener('click', () => {
                    // do not save changes; just hide modal and use stored setting
                    loadSettingsToUI();
                    hideSettingsModal();
                });
            }

            // Wire the in-game toggle so user can change sound during gameplay
            if (inGameToggle) {
                // reflect currently loaded setting
                try { loadSettingsToUI(); } catch(e){}
                updateInGameToggleUI();
                inGameToggle.addEventListener('click', () => {
                    // toggle and persist
                    setSoundEnabled(!isSoundEnabled);
                    updateInGameToggleUI();
                });
                // ensure it's disabled initially while modal is open
                inGameToggle.disabled = !allowInteraction;
            }

            // Allow Escape to close the modal (acts like Cancel)
            document.addEventListener('keydown', (e) => {
                const modal = document.getElementById('settingsModal');
                if (!modal || modal.style.display === 'none') return;
                if (e.key === 'Escape') {
                    loadSettingsToUI();
                    hideSettingsModal();
                }
            });

            // Show modal immediately on load
            showSettingsModal();
        });


        function reloadPage() {
            if (canReload) {
                window.location.reload();
            }
        }


        function toggleDisplay(imgElement) {
            if (imgElement.style.display === "none") {
                imgElement.style.display = "block";
            } else {
                imgElement.style.display = "none";
            }
        }


        function handleComparison(divEl) {
            if (!allowInteraction) return; // ignore clicks while settings are open
            playSound(clickSnd);

            const imgElement = divEl.querySelector("img");
            const imgSrc = imgElement.src;

            if (!matchValue1 && !matchValue2){
                matchElement1 = divEl;
                matchValue1 = imgSrc;
                console.log("First selection made.");
            } else {
                if (matchValue1 && !matchValue2){
                    matchElement2 = divEl;
                    if (matchElement1 === matchElement2){
                        console.log("Same element clicked twice. Choose another.");
                        matchElement2 = null;
                        return;}
                    matchValue2 = imgSrc;
                    console.log("Second selection made.");
                }
                if (matchValue1 && matchValue2){
                    if (matchValue1 === matchValue2){
                        playSound(correctSnd);
                        console.log(" ");
                        console.log("It's a match!");
                        matchElement1.onclick = null;
                        matchElement2.onclick = null;
                        matchesFound += 1;
                        if (matchesFound === matchGoal){
                            document.getElementById("fill").textContent = "Play Again?";
                            canReload = true;
                            playSound(winSnd);
                            console.log(" ");
                            console.log("Congratulations! You've found all matches!");
                        }
                    } else {
                        console.log("No match.");
                        let imgEl1 = matchElement1.querySelector("img");
                        let imgEl2 = matchElement2.querySelector("img");
                        setTimeout(() => {
                            toggleDisplay(imgEl1);
                            toggleDisplay(imgEl2);
                        }
                        , 1000);
                    }
                    matchElement1 = null;
                    matchValue1 = null;
                    matchElement2 = null;
                    matchValue2 = null;
                }
            }
            toggleDisplay(imgElement);
        }


        let canReload = false;

        const correctSnd = new Audio("aud/correct.mp3"); // buffers automatically when created
        correctSnd.volume = 0.3;
        // https://pixabay.com/sound-effects/the-correct-answer-33-183620/

        const winSnd = new Audio("aud/win.mp3"); // buffers automatically when created
        // https://pixabay.com/sound-effects/you-win-sequence-2-183949/

        const clickSnd = new Audio("aud/click_003.ogg"); // buffers automatically when created
        // https://kenney.nl/assets/interface-sounds

        let matchElement1 = null;
        let matchValue1 = null;
        let matchElement2 = null;
        let matchValue2 = null;

        let matchesFound = 0;

        const srcArray = [
            "https://upload.wikimedia.org/wikipedia/en/8/89/SuperMarioRPGSNESCoverArtUS.jpg", // Wikpedia image uploaded by IceWelder
            "https://upload.wikimedia.org/wikipedia/en/e/e4/Smetroidbox.jpg", // Wikpedia image uploaded by Neocorelight
            "https://upload.wikimedia.org/wikipedia/en/3/32/Super_Mario_World_Coverart.png", // Wikpedia image uploaded by IceWelder
            "https://upload.wikimedia.org/wikipedia/en/a/a7/Chrono_Trigger.jpg", // Wikpedia image uploaded by Veikk0.ma
            "https://upload.wikimedia.org/wikipedia/en/2/21/The_Legend_of_Zelda_A_Link_to_the_Past_SNES_Game_Cover.jpg", // Wikpedia image uploaded by NintenBOUND
            "https://upload.wikimedia.org/wikipedia/en/1/1f/EarthBound_Box.jpg", // Wikpedia image uploaded by Czar
            "https://upload.wikimedia.org/wikipedia/en/f/f1/Mega_Man_X_Coverart.png", // Wikpedia image uploaded by IceWelder
            "https://upload.wikimedia.org/wikipedia/en/1/1a/Donkey_Kong_Country_SNES_cover.png", // Wikpedia image uploaded by IceWelder
            "https://upload.wikimedia.org/wikipedia/en/3/38/Supermariokart_box.JPG", // Wikpedia image uploaded by IceWelder
            "https://upload.wikimedia.org/wikipedia/en/3/3c/Super_Mario_All_Stars_%28game_box_art%29.jpg", // Wikpedia image uploaded by DatBot
            "https://upload.wikimedia.org/wikipedia/en/c/c3/DK_Country_2.jpg", // Wikpedia image uploaded by DatBot
            "https://upload.wikimedia.org/wikipedia/en/9/9a/Yoshi%27s_Island_%28Super_Mario_World_2%29_box_art.jpg" // Wikpedia image uploaded by IceWelder
        ];
        const matchGoal = srcArray.length; // Number of unique images to match
        const srcArrayDouble = srcArray.concat(srcArray); // Duplicate the array for pairs
        const srcArrayDoubleShuffled = srcArrayDouble.sort(() => Math.random() - 0.5); // Shuffle the array

        // Assign images to elements
        const elements = document.querySelectorAll(".getsImg");
        elements.forEach((el, idx) => {
            const newChildImg = el.appendChild(document.createElement("img"));
            newChildImg.style.display = "none";
            newChildImg.src = srcArrayDoubleShuffled[idx];
        });

        // Ensure click audio won't play on load if user disabled sound
        // (load setting so `isSoundEnabled` reflects persisted preference)
        try { loadSettingsToUI(); } catch(e){}

        // Update the floating toggle UI to match initial state
        function updateInGameToggleUI() {
            const btn = document.getElementById('inGameToggle');
            if (!btn) return;
            if (isSoundEnabled) {
                btn.textContent = 'ðŸ”Š';
                btn.setAttribute('aria-pressed','true');
                btn.title = 'Sound is ON â€” click to mute';
            } else {
                btn.textContent = 'ðŸ”‡';
                btn.setAttribute('aria-pressed','false');
                btn.title = 'Sound is OFF â€” click to unmute';
            }
            btn.disabled = !allowInteraction;
        }

    </script>
</body>
</html>
